name: Automated API tests using Postman CLI

on: push

jobs:
  automated-api-tests:
    services:
      your-service:
        image: your-docker-image:latest
        ports:
          - 7173:7173
        options: --health-cmd="curl --silent --fail http://localhost:7173/health || exit 1" --health-timeout=5s --health-retries=3
    
    
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Install Postman CLI
        run: |
          powershell.exe -NoProfile -InputFormat None -ExecutionPolicy AllSigned -Command "[System.Net.ServicePointManager]::SecurityProtocol = 3072; iex ((New-Object System.Net.WebClient).DownloadString('https://dl-cli.pstmn.io/install/win64.ps1'))"
      - name: Verify Postman CLI Installation
        run: postman --version
      - name: Login to Postman CLI
        run: postman login --with-api-key ${{ secrets.POSTMAN_API_KEY }}
      - name: Run API tests
        run: |
          postman collection run "9578175-59faff03-6266-4623-a317-03587212e823" -e "9578175-44037ed4-9749-40ba-9ca9-f18e098f34c5"
